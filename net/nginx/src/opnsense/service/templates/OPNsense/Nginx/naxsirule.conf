{% macro naxsi_rule(uuid, rule, ruletype) -%}
# {{ rule }}
# {{ uuid }}
# {{ ruletype }} "{% if rule.regex == '1' %}rx{% else %}str{% endif
%}:{{ rule.match_value }}" "msg:{{ rule.message
}}" "{{ rule.match_type }}:BODY" "s:$:{{ rule.score }}";
{%- endmacro %}

{% if naxsi_ruletype == 'basic' %}
{# current policy in loop is available as custom_policy, the uuid as custom_policy_uuid #}
{%   for naxsi_rule_uuid in custom_policy.naxsi_rules.split(',') %}
{%     if naxsi_rule_uuid not in added_policies %}
{{       naxsi_rule(naxsi_rule_uuid, helpers.getUUID(naxsi_rule_uuid), "BasicRule") }}
{%       do added_policies.append(naxsi_rule_uuid) %}
{%     endif %}
{%   endfor %}
{%   if naxsi_ruletype == 'main' %}
{#     naxsi_rule(custom_policy_uuid, custom_policy, "MainRule") #}
{%   endif %}
{% endif %}